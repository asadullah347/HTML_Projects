<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>피하기 게임</title>
    <style>
        #game
        {
        width: 300px; height: 400px;
        border: 2px solid #000;
        position: relative;
        overflow: hidden;
        background: #f9f9f9;
        }

        #player
        {
        width: 30px; height: 30px;
        background: blue;
        position: absolute;
        bottom:  10px; left: 135px;
        }


        #enemy
        {
        width: 30px; height: 30px;
        background: red;
        position: absolute;
        top: 0; left: 135px;
        }

    </style>
</head>

<body>
    <h2>피하기 게임</h2>
    <div id="game">
        <div id="player"></div>
        <div id="enemy"></div>
    </div>
    <p id="score">Score: 0</p>
    <br>
    <p id="status"></p>


<script>

    const player = document.getElementById('player');
    const enemy = document.getElementById('enemy');
    const game = document.getElementById('game');

    let playerX = 135;
    let enemyY = 0;
    let enemyX = Math.floor(Math.random() * 270);
    let score = 0;
    let gameOver = false;


    document.addEventListener('keydown', (e) =>{
        //player 좌표 구하기
        if(gameOver) return;
        if(e.key == 'ArrowLeft' && playerX > 0) playerX -= 20;
        if(e.key == 'ArrowRight' && playerX < 270) playerX += 20;
        //player 그리기
        player.style.left = playerX + 'px';
    });


    function fall()
    {
        if(gameOver) return;

        //make enemy fall form top
        enemyY += 5;
        enemy.style.top = enemyY + 'px';
        enemy.style.left = enemyX + 'px';

        if(enemyY > 400){
            enemyY = 0;
            enemyX = Math.floor(Math.random() * 270);
            document.getElementById('score').textContent = "Score: " + score++;
        }

        //collison detection
        if(enemyY > 360 && Math.abs(enemyX - playerX) < 30)
        {
            document.getElementById('status').textContent = "GameOver!";
            gameOver = true;
        }

        //requestAnimationFrame은 브라우저 재생 주기(프레임)에 맞춰 fall 함수 재호출하여 애니메이션 자연스럽게 유지
        requestAnimationFrame(fall); 
    }
    
    fall(); //최초 호출로 game loop 시작

</script>
</body>
</html>
